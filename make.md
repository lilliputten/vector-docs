> $Id: make.md 10426 2018-07-31 16:21:31Z miheev $
> $Date: 2018-07-31 19:21:31 +0300 (Вт, 31 июл 2018) $

Процедура сборки и конфигурация
===============================

Основная сборка и вспомогательные задачи запускаются с помощью поточного сборщика gulp:

`gulp {target}`

Отдельные задачи (частичная сборка, тесты, линтинг, запуск сервера, очистка могут выполняться при помощи отдельных консольных команд.

Вызовы `gulp` могут производиться из менеджера npm и из удалённого скрипта `remote.php`:

- `npm run -s make`
- `http://youcomp.geyser.ru:8082/WEB_TINTS/remote.php?make`
- `http://185.41.41.90:8082/WEB_TINTS/remote.php?make`

## Конфигурация

- `WEB_TINTS/source/gulpfile.config.yaml` -- Конфигурация gulp.
- `WEB_TINTS/source/gulpfile.js` -- Управляющий скрипт gulp.

## Список команд gulp

### Сборка

- `all` (`regenerate`) -- Очистить иересобрать всё, включая библиотки (`init`, `bem`, `inject`)
- `make` (`bem`) -- Низкоуровневая сборка -- запуск `enb make` с переменной окружения `YENV=inject`.
- `remake` (`default`) -- Очистить и пересобрать всё, кроме библиотек (без `bem`, `inject`). Основная команда, если в статических файлах ничего не менялось.

### Очистка

- `cleanAll` -- Очистить всё.
- `cleanBem` -- Удалить сгенерированные при enb-сборке файлы. См. переменную конфигурации gulpfile `PAGES_PATH`.
- `cleanCache` -- Очистка кеша phalcon. См. переменную конфигурации gulpfile `CACHE_FILES`.
- `cleanFakeData` -- Очищаем накопленные для эмуляции сервера приложений при локальной разработке данные. См. переменную конфигурации gulpfile `FAKE_DATA_PATH`.
- `cleanInit` -- Очистка статических файлов. См. переменную конфигурации gulpfile `CLEAN_INIT_FILES`.
- `cleanInject` -- Удаление установленной сборки. См. переменные конфигурации gulpfile `APP_TARGET_NAME`, `APP_TARGET_EXT`, `CLEAN_INJECT_FILES`.
- `cleanLogs` -- Очистка логов phalcon. См. переменную конфигурации gulpfile `LOGS_FILES`.
- `cleanStable` -- Удаление папки stable-версии. См. переменную конфигурации gulpfile `STABLE_PATH`.

### Прочие

- `bootstrapJs` -- Пересобрать js для библиоткеи bootstrap в соответствии с заданным списком файлов.
- `stable` -- Удаление папки stable-версии. См. переменную конфигурации gulpfile `STABLE_PATH`.
- `tags` -- Создать список тегов (ctags). Используется внешняя команда `gulp-javascript-ctags`.

## Список команд для удалённого скрипта `remote.php`

- `all` -- Перегенерить всё (`gulp all`).
- `cleanCache` -- Очистка данных приложения (php/phalcon).
- `clean` -- Очистить файлы сборщика, временные файлы, тестовые данные (осторожно! как минимум надо будет перегенирить проект!).
- `cleanup` -- Очистить состояние svn (`svn cleanup`).
- `commit` -- Синхронизировать изменения на сервере с репозиторием svn (сделать коммит).
- `lint` -- Запустить проверку.
- `log` -- Показать лог svn.
- `redis_flush` -- очистка кеша redis.
- `remake` -- Перегенерить без копирования статики (без gulp init) `gulp remake`.
- `stable` -- Создать stable-версию проекта.
- `test` -- Проверка работоспособности (выводит лог svn с одной последней записью и текст "ok").
- `tests` -- Запустить тесты (на сервере не работает!).
- `update` -- Обновить из svn.

